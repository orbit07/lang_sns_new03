1. アプリのコンセプト整理
ブラウザだけで動く 言語練習用ミニSNS。
投稿・リプライで4言語を書いて、音声再生（SpeechSynthesis）で発音確認できる。
データはすべて ローカルストレージ保存。
インポート／エクスポートでバックアップ・引き継ぎ可能。

X(Twitter)風UI：
タイムライン
検索・タグ絞り込み
画像付きポスト
いいね・リポスト
…などをミニマム実装。

2. 画面構成（タブ4つ）
2-1. タイムラインタブ（メイン）
全ポストを 新着順（降順） に表示。
各ポストの直下に、そのポストへのリプライを 古い順（昇順） で展開表示。

表示内容：
投稿時間（必須）
テキストボックス1〜3個
各ボックスのテキスト
言語ラベル（例：EN / KO / zh-TW / JA）
再生ボタン（日本語選択時は非活性）
画像（あれば1枚）
抽出されたタグの一覧（#tag をチップ表示）

アクションボタン：
返信
編集
削除
いいね（ON/OFF）
リポスト

削除されたポスト：
リプライがついているポストを削除した場合
→ ポスト部分は「削除されました」とだけ表示（タイムライン上に残る）
→ リプライはそのまま表示。
リプライがついていないポストを削除した場合
→ 完全削除してタイムラインから消える。

2-2. 検索タブ
検索条件入力UI：
テキスト入力欄（フリーワード検索用）
全テキストボックスの文字列を対象に 部分一致 検索。

タグ検索：
#tagname を入力した場合、そのタグを含むポストだけ表示。

検索結果：
タイムラインと同じカードUIでポストを表示。
デフォルト並び順：新着順（降順）。

他タブからの連携：
タイムライン／画像タブ／いいねタブでタグチップをクリック
→ 検索タブに遷移し、そのタグを条件にした結果を表示。

2-3. 画像タブ
画像付きポストのみ、新着順で表示。
（設計上の前提）
元ポストのみ対象 とする（リプライの画像は含めない方がシンプル）。
必要なら後で「リプライも含める」仕様に拡張可能。
表示UIはタイムラインとほぼ同じだが、
カードのサムネイル的に画像を目立たせる。

2-4. いいねタブ
ユーザーが「いいね」したポストのみを新着順で表示。

並び順：
（設計案）いいねした時刻 でソート
→ 表示のために likedAt を保存しておく。
表示UIはタイムラインとほぼ同じ。

いいね解除した場合：
このタブからは即時非表示。

3. 投稿モーダル & リプライモーダル
3-1. 共通仕様
投稿・リプライともに モーダルウィンドウ で入力。

入力項目：
テキストボックス 1〜3 個（可変）
textarea

言語選択セレクトボックス
日本語（音声なし）
英語（Samantha(en-US)）
韓国語（Yuna(ko-KR)）
台湾華語（Meijia(zh-TW)）
SpeechSynthesis 再生ボタン
画像アップロード（任意・1枚まで）
画像は Data URL で保持する想定。

テキストボックスの増減UI：
最初は1つ必須。
「＋」ボタン：ボックス追加（最大3つ）。
各ボックス右上に「×」ボタン：削除。
ボックスが1つだけのときは削除不可。

ボタン：
「キャンセル」
「投稿」（または「返信」）

バリデーション：
すべてのテキストボックスが空の場合は投稿不可。

3-2. 編集時
既存ポスト／リプライの内容をモーダルにセットして表示。

編集可能なもの：
テキストボックス（数・内容・言語）
画像の差し替え・削除

保存時：
updatedAt を更新。
createdAt はそのまま維持。

4. ポストとリプライのルール
4-1. ポスト
できること：
投稿／編集／削除
リプライの受付
いいね
リポスト

削除時の挙動：
リプライなし → 完全削除。
リプライあり → isDeleted = true にして本文非表示。
UIは「このポストは削除されました。」など固定メッセージ。

4-2. リプライ
機能はポストと同じ（テキストボックス複数、画像、タグ、編集、削除）。

できないこと：
いいね
リポスト
リプライへのリプライ（階層は1段まで）

タイムライン表示：
親ポストの直下に、古い順で並べる。

5. 言語設定 & SpeechSynthesis
5-1. 対応言語と音声
各テキストボックスごとに言語を選択し、それに対応する音声で再生：
日本語：音声なし（再生ボタンを無効化、もしくは非表示）
英語：Samantha（en-US）
韓国語：Yuna（ko-KR）
台湾華語：Meijia（zh-TW）

5-2. 再生ロジック
再生ボタン押下：
選択された言語から対応voiceを取得。
テキストボックスの内容を一つだけ SpeechSynthesisUtterance で読み上げ。

長文バグ対策：
仕様として「1テキストボックス＝比較的短文」を想定。
長文になる場合はユーザーが自分でボックスを分割できるUIとすることで回避。

6. タグの仕様
6-1. タグの抽出
ポスト／リプライの全テキストからタグを抽出。

ルール：
# に続く文字列を、スペース or 改行 まで 取得。
例：今日は #韓国語 勉強する #勉強
→ ["韓国語", "勉強"]

保存：
ポスト／リプライそれぞれに tags: string[] を持たせる。
検索時は tags からも参照。

6-2. タグクリック
どのタブでもタグをクリック可能。

クリック時の挙動：
検索タブへタブ切り替え。
選択したタグを検索条件にセット。
タグ一致ポストのみ一覧表示。

7. いいね & リポスト
7-1. いいね
対象：ポストのみ（リプライは不可）。

状態：
liked: boolean
likedAt: string | null（ISO日時文字列）

タイムライン上：
ハートアイコンなどでON/OFF表示。

いいねタブ：
liked === true のポストだけ表示。
並び順は likedAt の降順。

7-2. リポスト
対象：ポストのみ。

挙動：
対象ポストの
textBlocks
image
tags
をコピーした新規ポストを作成。
createdAt は現在時刻。
repostFromId に元ポストIDを記録。

表示：
タイムラインで「リポスト」などの小さなラベルを表示すると分かりやすい（任意）。

8. データ構造（設計案）
8-1. 型イメージ
type LangCode = "ja" | "en" | "ko" | "zh-TW";

type TextBlock = {
  id: string;        // ボックス識別子
  text: string;
  lang: LangCode;    // "ja" の場合は音声なし処理
};

type ImageData = {
  id: string;
  dataUrl: string;   // FileReaderで取得したBase64 Data URL
};

type Post = {
  id: string;
  createdAt: string;   // ISO文字列
  updatedAt: string;   // ISO文字列
  isDeleted: boolean;
  textBlocks: TextBlock[];
  image?: ImageData | null;
  tags: string[];
  liked: boolean;
  likedAt?: string | null;
  repostFromId?: string | null;
};

type Reply = {
  id: string;
  postId: string;      // 親ポストのID
  createdAt: string;
  updatedAt: string;
  isDeleted: boolean;  // （仕様上、削除されたら完全非表示でもOK）
  textBlocks: TextBlock[];
  image?: ImageData | null;
  tags: string[];
};

8-2. ローカルストレージ保存形式
type AppData = {
  posts: Post[];
  replies: Reply[];
  lastId: number;  // "id" を "post-1" "reply-3" のように作る用
};

保存キー例："lang_sns_app_data"

アプリ起動時：
localStorage から読み込み → AppData へパース。
なければ初期値 { posts: [], replies: [], lastId: 0 }。

9. インポート / エクスポート仕様
9-1. エクスポート
現在の AppData を JSON にしてダウンロード。
ファイル名例：lang-sns-backup-YYYYMMDD-HHmm.json

9-2. インポート
JSONファイル選択 → パース → AppData 形式かを軽くバリデーション。

インポート後の扱い（設計案）：
上書き読み込み
既存データを削除し、インポートした内容で置き換え。
必要なら将来「マージインポート」オプション追加も可能。

10. 非機能要件（軽く）
ブラウザのみで完結（HTML + JS + CSS）。
ログイン機能なし（1端末＝1アカウント想定）。
モバイル（スマホ）でも使いやすい、縦スクロール前提のUI。
データ量は数千ポスト程度までは問題ない想定（シンプルな配列操作）。

📌 投稿機能まわりの仕様（更新版）
● 投稿者名
なし（固定）

● 画像の表示
タイムライン上では 横幅：投稿カードいっぱい、縦：最大100px
アスペクト比は維持
画像は角丸（4px〜8px想定）
画像をクリック → フルスクリーンモーダルで拡大表示

● テキスト & タグ
テキストボックス1〜3個（可変）
タグは テキストの下段にまとめて表示
タグの次にアクションボタン

● アクションボタンの並び順
削除 → 編集 → リポスト → 返信 → いいね

● 削除されたポストの表示
isDeleted = true の場合、本文部を完全に置換して下記を表示：
このポストは削除されました
リプライは残す
タイムラインの位置はそのまま保持

📌 タイムライン表示仕様
● 並び順
ポスト：新着順（降順）
リプライ：古い順（昇順）
編集・削除後もポストの表示位置は変えない

● リプライ表示
常時展開
親ポストの直下に表示
左側にインデントを取り、階層が視覚的に分かるようにする

リプライには
削除
編集
返信不可
いいね不可
リポスト不可

📌 画像の保存と容量対策
● 保存形式
DataURL(Base64) をデータ構造にそのまま保存

● 追加機能（今回採用）
DataURLサイズが閾値（例：1MB）を超える場合、Canvasでリサイズして小さくして保存
処理例：横幅 900px に合わせて縮小（比率維持）

● 画像再利用（重複画像対策）
同じ画像をリポストした場合、新しいDataURLを作らず、既存画像のIDを参照

保存用構造：

images: {
   [imageId: string]: string (DataURL)
}
posts.imageId?: string
replies.imageId?: string

● 自動容量制御（要件として採用）
保存容量が上限を超えた場合：
古いポストから順に 画像だけ を削除
テキストは残す
imageRemoved: true のフラグを立てる
UIでは「画像は容量制限のため削除されました」と表示

📌 検索仕様
検索対象は テキストブロックのみ
タグは検索対象外（ただしクリック遷移は可能）
複数語 検索＝ AND 検索
"韓国語 発音" → 両方の語を含むポストのみヒット

📌 いいね・リポスト仕様
● いいね
数値表示なし
ON/OFFのみ
いいねタブでは、いいねした時刻の新しい順 で表示

● リポスト
ラベル表示あり（例）🔁 Repost
画像も含めて複製
DataURL画像の再利用（newコピーせず画像ID参照）

📌 モーダル仕様
新規投稿／リプライ投稿／編集はすべてモーダル

閉じ方：
×ボタン
背景クリック

編集モーダル：
変更あり → キャンセル時に確認ダイアログ
変更なし → そのまま閉じる

📌 外観デザイン（UI）
X風の白背景カードデザイン（ゴシック体）
カードに影は弱め
サムネイル画像は角丸
ボタン・アイコンはモノトーン寄りシンプル
投稿者アイコンなしで構成

📌 JSONデータのバージョン管理

保存ファイル：

{
  "version": 1,
  "posts": [...],
  "replies": [...],
  "images": {...},
  "lastId": 128
}

将来仕様変更があってもマイグレーションしやすい構成。

✅ 動作テストチェックリスト（総合）
🔹 A. ポスト作成まわり
項目	期待結果
1. テキストボックス1つで投稿できる	投稿成功
2. テキストボックス0個では投稿できない	エラー or 投稿ボタン無効
3. テキストボックスを追加できる	最大3個まで追加される
4. テキストボックスを削除できる	最低1個は残る
5. 各ボックスの言語を選択できる	言語選択の保持
6. 音声再生ボタンの挙動	日本語以外は読み上げ / 日本語はボタン無効
7. 画像を添付できる	1枚だけ追加可
8. 画像を削除できる	投稿前に削除可
9. 投稿後に即タイムラインへ反映	降順で先頭に表示
10. モーダル背景クリック or ×で閉じる	正しく閉じる
🔹 B. タイムライン表示
項目	期待
1. 新規ポストが一番上に表示される	createdAt降順
2. テキストブロックが順に表示される	ボックス順固定
3. タグ抽出が正しく行われる	#～空白/改行まで
4. 画像表示	横幅いっぱい、縦最大100px、角丸
5. 画像クリックで拡大モーダル表示	閉じれる
6. アクションボタン順	削除→編集→リポスト→返信→いいね
🔹 C. リプライ機能
項目	期待
1. リプライ投稿できる	親ポストの下に表示
2. 並び順が古い順	createdAt昇順
3. 左にインデントされている	階層視覚化
4. 編集できる	内容・画像変更反映
5. 削除できる	削除後は完全非表示
6. いいね不可 / リポスト不可	ボタン非表示 or 無効
🔹 D. 削除仕様
項目	期待
1. リプライなしポスト削除	完全消える
2. リプライありポスト削除	本文が「このポストは削除されました」に置換
3. 削除後もタイムライン順を保持	表示位置そのまま
🔹 E. 編集仕様
項目	期待
1. モーダルに現在値が入っている	読み込みOK
2. テキスト追加・削除を反映	保存後タイムライン更新
3. 言語変更も保存される	UI・音声も変わる
4. 編集キャンセル時	変更あり→破棄確認ダイアログ
5. 編集後でもタイムライン順変更なし	位置固定
🔹 F. いいね / リポスト
項目	期待
1. いいねON/OFF切替	即UI反映
2. いいねタブで表示	likedAt降順
3. リポスト投稿	複製ポストが現在時刻で投稿される
4. リポストにはラベル表示	🔁 Repost
5. 画像つきリポスト	画像ID再利用（複製しない）
🔹 G. 検索
項目	期待
1. キーワード単体検索	一致するポストのみ表示
2. 複数語検索（スペース区切り）	AND検索
3. 検索結果の並び順	createdAt降順
4. タグクリック→検索タブ遷移	自動入力＋絞り込み
🔹 H. ローカルストレージ
項目	期待
1. F5リロード後もデータ保持	消えない
2. 投稿→即保存	タイミングズレなし
3. 削除・編集も保存反映	永続化される
🔹 I. インポート / エクスポート
項目	期待
1. エクスポートでJSONダウンロード	AppDataそのまま
2. インポートで完全上書き	旧データ消して新データロード
3. versionフィールド保持	破損防止
4. 不正ファイル読み込み時	エラー通知 or 何もしない
🔹 J. 画像容量制御
項目	期待
1. 保存前リサイズ動作	幅900pxに縮小
2. 容量上限時の自動画像削除	古い順に画像のみ除去
3. 画像削除表示	「画像は容量制限のため削除されました」
4. リポスト画像参照	画像ID再利用
🔹 K. スマホUI（レスポンシブ）
項目	期待
1. タブは横並び or 下部固定	タップしやすい
2. 文字が潰れない	最低14px
3. 画像拡大モーダルが全画面	スクロール可能